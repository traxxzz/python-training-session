"""Unit test for kdbloghandler.py"""

__author__ = 'Ilya Romanchenko'

import kdbloghandler
import unittest

filename = "C:/Documents and Settings/romaily/My Documents/EUR.USD.2"
# filename = "/home/abbath/Downloads/EUR.USD.2"

output = """
{'askCount': '', 'exchQuantumTime': '', 'bidPrice': '1.3499', 'ask10': {'askCount': '', 'askPrice': '1.3509', 'askSize': '13000000'}, 'exchTime': '13:00:00.250', 'bid9': {'bidSize': '6000000', 'bidPrice': '1.34995', 'bidCount': ''}, 'bid8': {'bidSize': '11000000', 'bidPrice': '1.35', 'bidCount': ''}, 'bid7': {'bidSize': '6000000', 'bidPrice': '1.35005', 'bidCount': ''}, 'bid6': {'bidSize': '11000000', 'bidPrice': '1.3501', 'bidCount': ''}, 'bid5': {'bidSize': '6000000', 'bidPrice': '1.35015', 'bidCount': ''}, 'bid4': {'bidSize': '10000000', 'bidPrice': '1.3502', 'bidCount': ''}, 'bid3': {'bidSize': '7000000', 'bidPrice': '1.35025', 'bidCount': ''}, 'bid2': {'bidSize': '9000000', 'bidPrice': '1.3503', 'bidCount': ''}, 'bid1': {'bidSize': '1000000', 'bidPrice': '1.35035', 'bidCount': ''}, 'exchDate': '2013.09.26', 'globalSeqNum': '113443286238', 'bidCount': '', 'askSize': '13000000', 'seqNum': '2464310', 'askPrice': '1.3509', 'bid10': {'bidSize': '12000000', 'bidPrice': '1.3499', 'bidCount': ''}, 'sym': 'EURUSD', 'date': '2013.09.26', 'bidSize': '12000000', 'exch': 'EBSUSDEUN', 'ask5': {'askCount': '', 'askPrice': '1.35065', 'askSize': '2000000'}, 'ask4': {'askCount': '', 'askPrice': '1.3506', 'askSize': '14000000'}, 'ask7': {'askCount': '', 'askPrice': '1.35075', 'askSize': '2000000'}, 'ask6': {'askCount': '', 'askPrice': '1.3507', 'askSize': '16000000'}, 'ask1': {'askCount': '', 'askPrice': '1.35045', 'askSize': '7000000'}, 'ask3': {'askCount': '', 'askPrice': '1.35055', 'askSize': '3000000'}, 'level': '10', 'ask2': {'askCount': '', 'askPrice': '1.3505', 'askSize': '12000000'}, 'ask9': {'askCount': '', 'askPrice': '1.35085', 'askSize': '2000000'}, 'ask8': {'askCount': '', 'askPrice': '1.3508', 'askSize': '11000000'}, 'time': '13:00:00.251', 'cond': 'Dealable'}
{'askCount': '', 'exchQuantumTime': '', 'bidPrice': '1.34985', 'exchTime': '13:00:00.250', 'bid5': {'bidSize': '83000000', 'bidPrice': '1.34985', 'bidCount': ''}, 'bid4': {'bidSize': '67000000', 'bidPrice': '1.34995', 'bidCount': ''}, 'bid3': {'bidSize': '50000000', 'bidPrice': '1.35005', 'bidCount': ''}, 'bid2': {'bidSize': '33000000', 'bidPrice': '1.35015', 'bidCount': ''}, 'bid1': {'bidSize': '17000000', 'bidPrice': '1.35025', 'bidCount': ''}, 'bidCount': '', 'globalSeqNum': '113443286243', 'exchDate': '2013.09.26', 'askSize': '84000000', 'seqNum': '2464311', 'askPrice': '1.35095', 'sym': 'EURUSD', 'date': '2013.09.26', 'bidSize': '83000000', 'exch': 'EBSUSDEUN', 'ask5': {'askCount': '', 'askPrice': '1.35095', 'askSize': '84000000'}, 'ask4': {'askCount': '', 'askPrice': '1.35085', 'askSize': '69000000'}, 'ask1': {'askCount': '', 'askPrice': '1.35055', 'askSize': '22000000'}, 'ask3': {'askCount': '', 'askPrice': '1.35075', 'askSize': '56000000'}, 'level': '5', 'ask2': {'askCount': '', 'askPrice': '1.35065', 'askSize': '38000000'}, 'time': '13:00:00.251', 'cond': 'Spread'}
{'askCount': '', 'exchQuantumTime': '', 'bidPrice': '1.3477', 'exchTime': '13:00:01.995', 'bid5': {'bidSize': '250000000', 'bidPrice': '1.3477', 'bidCount': ''}, 'bid4': {'bidSize': '200000000', 'bidPrice': '1.349', 'bidCount': ''}, 'bid3': {'bidSize': '150000000', 'bidPrice': '1.3493', 'bidCount': ''}, 'bid2': {'bidSize': '100000000', 'bidPrice': '1.3498', 'bidCount': ''}, 'bid1': {'bidSize': '50000000', 'bidPrice': '1.35005', 'bidCount': ''}, 'bidCount': '', 'globalSeqNum': '113443286387', 'exchDate': '2013.09.26', 'askSize': '250000000', 'seqNum': '2464333', 'askPrice': '1.353', 'sym': 'EURUSD', 'date': '2013.09.26', 'bidSize': '250000000', 'exch': 'EBSUSDEUN', 'ask5': {'askCount': '', 'askPrice': '1.353', 'askSize': '250000000'}, 'ask4': {'askCount': '', 'askPrice': '1.3515', 'askSize': '200000000'}, 'ask1': {'askCount': '', 'askPrice': '1.3507', 'askSize': '50000000'}, 'ask3': {'askCount': '', 'askPrice': '1.3512', 'askSize': '150000000'}, 'level': '5', 'ask2': {'askCount': '', 'askPrice': '1.351', 'askSize': '100000000'}, 'time': '13:00:01.997', 'cond': 'Regular'}
{'askCount': '', 'exchQuantumTime': '', 'bidPrice': '1.3499', 'ask10': {'askCount': '', 'askPrice': '1.3509', 'askSize': '13000000'}, 'exchTime': '13:00:02.496', 'bid9': {'bidSize': '6000000', 'bidPrice': '1.34995', 'bidCount': ''}, 'bid8': {'bidSize': '11000000', 'bidPrice': '1.35', 'bidCount': ''}, 'bid7': {'bidSize': '6000000', 'bidPrice': '1.35005', 'bidCount': ''}, 'bid6': {'bidSize': '11000000', 'bidPrice': '1.3501', 'bidCount': ''}, 'bid5': {'bidSize': '6000000', 'bidPrice': '1.35015', 'bidCount': ''}, 'bid4': {'bidSize': '10000000', 'bidPrice': '1.3502', 'bidCount': ''}, 'bid3': {'bidSize': '7000000', 'bidPrice': '1.35025', 'bidCount': ''}, 'bid2': {'bidSize': '9000000', 'bidPrice': '1.3503', 'bidCount': ''}, 'bid1': {'bidSize': '1000000', 'bidPrice': '1.35035', 'bidCount': ''}, 'bidCount': '', 'globalSeqNum': '113443286407', 'exchDate': '2013.09.26', 'askSize': '13000000', 'seqNum': '2464337', 'askPrice': '1.3509', 'bid10': {'bidSize': '12000000', 'bidPrice': '1.3499', 'bidCount': ''}, 'sym': 'EURUSD', 'date': '2013.09.26', 'bidSize': '12000000', 'exch': 'EBSUSDEUN', 'ask5': {'askCount': '', 'askPrice': '1.35065', 'askSize': '2000000'}, 'ask4': {'askCount': '', 'askPrice': '1.3506', 'askSize': '14000000'}, 'ask7': {'askCount': '', 'askPrice': '1.35075', 'askSize': '2000000'}, 'ask6': {'askCount': '', 'askPrice': '1.3507', 'askSize': '16000000'}, 'ask1': {'askCount': '', 'askPrice': '1.35045', 'askSize': '6000000'}, 'ask3': {'askCount': '', 'askPrice': '1.35055', 'askSize': '3000000'}, 'level': '10', 'ask2': {'askCount': '', 'askPrice': '1.3505', 'askSize': '12000000'}, 'ask9': {'askCount': '', 'askPrice': '1.35085', 'askSize': '2000000'}, 'ask8': {'askCount': '', 'askPrice': '1.3508', 'askSize': '11000000'}, 'time': '13:00:02.498', 'cond': 'Dealable'}
{'askCount': '', 'exchQuantumTime': '', 'bidPrice': '1.3499', 'ask10': {'askCount': '', 'askPrice': '1.3509', 'askSize': '13000000'}, 'exchTime': '13:00:00.250', 'bid9': {'bidSize': '6000000', 'bidPrice': '1.34995', 'bidCount': ''}, 'bid8': {'bidSize': '11000000', 'bidPrice': '1.35', 'bidCount': ''}, 'bid7': {'bidSize': '6000000', 'bidPrice': '1.35005', 'bidCount': ''}, 'bid6': {'bidSize': '11000000', 'bidPrice': '1.3501', 'bidCount': ''}, 'bid5': {'bidSize': '6000000', 'bidPrice': '1.35015', 'bidCount': ''}, 'bid4': {'bidSize': '10000000', 'bidPrice': '1.3502', 'bidCount': ''}, 'bid3': {'bidSize': '7000000', 'bidPrice': '1.35025', 'bidCount': ''}, 'bid2': {'bidSize': '9000000', 'bidPrice': '1.3503', 'bidCount': ''}, 'bid1': {'bidSize': '1000000', 'bidPrice': '1.35035', 'bidCount': ''}, 'exchDate': '2013.09.26', 'globalSeqNum': '113443286238', 'bidCount': '', 'askSize': '13000000', 'seqNum': '2464310', 'askPrice': '1.3509', 'bid10': {'bidSize': '12000000', 'bidPrice': '1.3499', 'bidCount': ''}, 'sym': 'EURUSD', 'date': '2013.09.26', 'bidSize': '12000000', 'exch': 'EBSUSDEUN', 'ask5': {'askCount': '', 'askPrice': '1.35065', 'askSize': '2000000'}, 'ask4': {'askCount': '', 'askPrice': '1.3506', 'askSize': '14000000'}, 'ask7': {'askCount': '', 'askPrice': '1.35075', 'askSize': '2000000'}, 'ask6': {'askCount': '', 'askPrice': '1.3507', 'askSize': '16000000'}, 'ask1': {'askCount': '', 'askPrice': '1.35045', 'askSize': '7000000'}, 'ask3': {'askCount': '', 'askPrice': '1.35055', 'askSize': '3000000'}, 'level': '10', 'ask2': {'askCount': '', 'askPrice': '1.3505', 'askSize': '12000000'}, 'ask9': {'askCount': '', 'askPrice': '1.35085', 'askSize': '2000000'}, 'ask8': {'askCount': '', 'askPrice': '1.3508', 'askSize': '11000000'}, 'time': '13:00:00.251', 'cond': 'Dealable'}
{'askCount': '', 'exchQuantumTime': '', 'bidPrice': '1.34985', 'exchTime': '13:00:00.250', 'bid5': {'bidSize': '83000000', 'bidPrice': '1.34985', 'bidCount': ''}, 'bid4': {'bidSize': '67000000', 'bidPrice': '1.34995', 'bidCount': ''}, 'bid3': {'bidSize': '50000000', 'bidPrice': '1.35005', 'bidCount': ''}, 'bid2': {'bidSize': '33000000', 'bidPrice': '1.35015', 'bidCount': ''}, 'bid1': {'bidSize': '17000000', 'bidPrice': '1.35025', 'bidCount': ''}, 'bidCount': '', 'globalSeqNum': '113443286243', 'exchDate': '2013.09.26', 'askSize': '84000000', 'seqNum': '2464311', 'askPrice': '1.35095', 'sym': 'EURUSD', 'date': '2013.09.26', 'bidSize': '83000000', 'exch': 'EBSUSDEUN', 'ask5': {'askCount': '', 'askPrice': '1.35095', 'askSize': '84000000'}, 'ask4': {'askCount': '', 'askPrice': '1.35085', 'askSize': '69000000'}, 'ask1': {'askCount': '', 'askPrice': '1.35055', 'askSize': '22000000'}, 'ask3': {'askCount': '', 'askPrice': '1.35075', 'askSize': '56000000'}, 'level': '5', 'ask2': {'askCount': '', 'askPrice': '1.35065', 'askSize': '38000000'}, 'time': '13:00:00.251', 'cond': 'Spread'}
{'askCount': '', 'exchQuantumTime': '', 'bidPrice': '1.3499', 'ask10': {'askCount': '', 'askPrice': '1.3509', 'askSize': '13000000'}, 'exchTime': '13:00:00.250', 'bid9': {'bidSize': '6000000', 'bidPrice': '1.34995', 'bidCount': ''}, 'bid8': {'bidSize': '11000000', 'bidPrice': '1.35', 'bidCount': ''}, 'bid7': {'bidSize': '6000000', 'bidPrice': '1.35005', 'bidCount': ''}, 'bid6': {'bidSize': '11000000', 'bidPrice': '1.3501', 'bidCount': ''}, 'bid5': {'bidSize': '6000000', 'bidPrice': '1.35015', 'bidCount': ''}, 'bid4': {'bidSize': '10000000', 'bidPrice': '1.3502', 'bidCount': ''}, 'bid3': {'bidSize': '7000000', 'bidPrice': '1.35025', 'bidCount': ''}, 'bid2': {'bidSize': '9000000', 'bidPrice': '1.3503', 'bidCount': ''}, 'bid1': {'bidSize': '1000000', 'bidPrice': '1.35035', 'bidCount': ''}, 'exchDate': '2013.09.26', 'globalSeqNum': '113443286238', 'bidCount': '', 'askSize': '13000000', 'seqNum': '2464310', 'askPrice': '1.3509', 'bid10': {'bidSize': '12000000', 'bidPrice': '1.3499', 'bidCount': ''}, 'sym': 'EURUSD', 'date': '2013.09.26', 'bidSize': '12000000', 'exch': 'EBSUSDEUN', 'ask5': {'askCount': '', 'askPrice': '1.35065', 'askSize': '2000000'}, 'ask4': {'askCount': '', 'askPrice': '1.3506', 'askSize': '14000000'}, 'ask7': {'askCount': '', 'askPrice': '1.35075', 'askSize': '2000000'}, 'ask6': {'askCount': '', 'askPrice': '1.3507', 'askSize': '16000000'}, 'ask1': {'askCount': '', 'askPrice': '1.35045', 'askSize': '7000000'}, 'ask3': {'askCount': '', 'askPrice': '1.35055', 'askSize': '3000000'}, 'level': '10', 'ask2': {'askCount': '', 'askPrice': '1.3505', 'askSize': '12000000'}, 'ask9': {'askCount': '', 'askPrice': '1.35085', 'askSize': '2000000'}, 'ask8': {'askCount': '', 'askPrice': '1.3508', 'askSize': '11000000'}, 'time': '13:00:00.251', 'cond': 'Dealable'}
{'askCount': '', 'exchQuantumTime': '', 'bidPrice': '1.34985', 'exchTime': '13:00:00.250', 'bid5': {'bidSize': '83000000', 'bidPrice': '1.34985', 'bidCount': ''}, 'bid4': {'bidSize': '67000000', 'bidPrice': '1.34995', 'bidCount': ''}, 'bid3': {'bidSize': '50000000', 'bidPrice': '1.35005', 'bidCount': ''}, 'bid2': {'bidSize': '33000000', 'bidPrice': '1.35015', 'bidCount': ''}, 'bid1': {'bidSize': '17000000', 'bidPrice': '1.35025', 'bidCount': ''}, 'bidCount': '', 'globalSeqNum': '113443286243', 'exchDate': '2013.09.26', 'askSize': '84000000', 'seqNum': '2464311', 'askPrice': '1.35095', 'sym': 'EURUSD', 'date': '2013.09.26', 'bidSize': '83000000', 'exch': 'EBSUSDEUN', 'ask5': {'askCount': '', 'askPrice': '1.35095', 'askSize': '84000000'}, 'ask4': {'askCount': '', 'askPrice': '1.35085', 'askSize': '69000000'}, 'ask1': {'askCount': '', 'askPrice': '1.35055', 'askSize': '22000000'}, 'ask3': {'askCount': '', 'askPrice': '1.35075', 'askSize': '56000000'}, 'level': '5', 'ask2': {'askCount': '', 'askPrice': '1.35065', 'askSize': '38000000'}, 'time': '13:00:00.251', 'cond': 'Spread'}"""

class KnownValues(unittest.TestCase):
    knownValues = output

    def testKnownValues(self):
        result = ''
        with open(filename, "rb") as csvfile:
            marketdata = kdbloghandler.CSVKdbLogHandler(csvfile)
            for i in range(4):
                result += '\n{}'.format(marketdata.get_next_record())
            for iteration in range(2):
                i = 1
                for record in marketdata:
                    result += '\n{}'.format(record)
                    if i >= 2: break
                    i += 1
        self.assertEqual(result, self.knownValues)

if __name__ == "__main__":
    unittest.main()